import{d as ne,s as k,h as D,y as le,R as we,at as Ce,b as u,I as P,w as i,T as Te,as as Re,o as n,aj as _e,ak as $e,j as X,r as U,c as M,D as j,e as A,E as F,J as oe,n as ie,t as Fe,F as Y,P as Se,W as q,M as T,k as s,av as Q,ax as Z,v as Be,am as Oe,a6 as Ae,ad as Ee,a as re}from"./framework.DXFcsTCa.js";import{R as G,a as Ve,_ as Ie}from"./index.afCUrAH6.js";import{b as Ne,a as Pe,_ as Ue}from"./index.BtTgaR5U.js";import{b as De,i as Me,a as He,c as Le,d as ze,g as Ke,e as je,f as Ye,o as x}from"./omit.BWdboJYH.js";import{i as We,r as Xe,f as qe,s as Ge}from"./index.BgWpqbC7.js";import{u as Je}from"./useFullscreen.Dnakn0Dl.js";import{i as ue,u as Qe}from"./useTable.fdNC2tzx.js";/* empty css              */import"./theme.D5dyfCpL.js";import"./aria.WZwNYelk.js";var Ze=1,xe=4;function se(t){return De(t,Ze|xe)}var et="[object Map]",tt="[object Set]",ot=Object.prototype,nt=ot.hasOwnProperty;function te(t){if(t==null)return!0;if(Me(t)&&(We(t)||typeof t=="string"||typeof t.splice=="function"||He(t)||Le(t)||ze(t)))return!t.length;var h=Ke(t);if(h==et||h==tt)return!t.size;if(je(t))return!Ye(t).length;for(var p in t)if(nt.call(t,p))return!1;return!0}function lt(t,h,p){return t==null?t:Ne(t,h,p)}const at={class:"u-context-menu__list"},rt=["onClick"],st={class:"u-context-menu-item__label"},me=ne({name:"UContextMenu",__name:"context-menu",props:{triggerSelectors:{},afterClickHide:{type:Boolean,default:!0},offsetX:{default:0},offsetY:{default:0},manual:{type:Boolean,default:!1},items:{default:()=>[]}},emits:["show","hide","select"],setup(t,{expose:h,emit:p}){const l=t,b=p,S=k(),R=k(!1),e=k({top:100,left:100}),v=D(()=>({top:`${e.value.top}px`,left:`${e.value.left}px`,visibility:R.value?"visible":"hidden"})),m=f=>{const{pageX:w,pageY:B,clientX:o,clientY:d}=f,O=window.innerWidth,N=window.innerHeight,g=S.value;if(!g)return{top:0,left:0};const{offsetWidth:L,offsetHeight:z}=g,a=o+L>O?w-L+l.offsetX:w+l.offsetX;return{top:d+z>N?B-z+l.offsetY:B+l.offsetY,left:a}},V=f=>{const w=f.target;if(!w){console.warn("无效的事件目标");return}(!l.triggerSelectors||w.closest(l.triggerSelectors)!==null)&&(f.preventDefault(),e.value=m(f),R.value=!0,b("show"),document.addEventListener("click",_))},_=f=>{const w=f.target;!l.afterClickHide&&w.closest(".u-context-menu")||(R.value=!1,b("hide"),document.removeEventListener("click",_))},I=f=>{b("select",f)};return le(()=>{l.manual||we(()=>{document.addEventListener("contextmenu",V)})}),Ce(()=>{document.removeEventListener("contextmenu",V),document.removeEventListener("click",_)}),h({showMenu:V,hideMenu:_}),(f,w)=>{const B=F("el-icon");return n(),u(Re,{to:"body"},[P(Te,{name:"u-context-menu"},{default:i(()=>[_e(X("div",{ref_key:"contextMenuRef",ref:S,class:"u-context-menu",style:Se(v.value)},[U(f.$slots,"default",{},()=>[X("ul",at,[(n(!0),M(Y,null,j(f.items,o=>(n(),M("li",{key:o.name,class:"u-context-menu-item",onClick:d=>I(o)},[o.icon?(n(),u(B,{key:0,class:"u-context-menu-item__icon"},{default:i(()=>[(n(),u(oe(o.icon)))]),_:2},1024)):A("",!0),o.iconClass?(n(),M("i",{key:1,class:ie(["u-context-menu-item__icon",o.iconClass])},null,2)):A("",!0),X("span",st,Fe(o.label),1)],8,rt))),128))])])],4),[[$e,R.value]])]),_:3})])}}}),de=me;de.install=t=>{t.component("UContextMenu",me)};const it=t=>({getElTableColumnAttrs:D(()=>x(t.item,["children","formatter","render","component","rendered","element","rules","attrs","renderHeader"])),getFormItemRules:l=>l.required?[{required:!0,message:"请输入"}]:l.rules?l.rules.map(b=>({message:"请输入",...b})):[]}),ut=ne({__name:"table-column",props:{item:{},editable:{type:Boolean}},emits:["click-operation"],setup(t,{emit:h}){const p=t,l=h,{getElTableColumnAttrs:b,getFormItemRules:S}=it(p),R=D(()=>{const{prop:e,rendered:v=!0,show:m=!0}=p.item;return typeof v=="function"?e&&v(p.item)&&m:e&&v&&m});return(e,v)=>{const m=F("TableColumn",!0),V=F("el-cascader"),_=F("el-checkbox"),I=F("el-radio"),f=F("el-option"),w=F("el-form-item"),B=F("el-table-column");return R.value?(n(),u(B,q(T({key:0},s(b))),{header:i(o=>[e.$slots[`header-${e.item.prop}`]?U(e.$slots,`header-${e.item.prop}`,T({key:0},o,{item:e.item})):e.item.renderHeader?(n(),u(s(G),{key:1,"v-node":e.item.renderHeader({...o,item:e.item})},null,8,["v-node"])):A("",!0)]),"filter-icon":i(o=>[e.$slots[`filter-icon-${e.item.prop}`]?U(e.$slots,`filter-icon-${e.item.prop}`,T({key:0},o,{item:e.item})):e.item.renderFilterIcon?(n(),u(s(G),{key:1,"v-node":e.item.renderFilterIcon({...o,item:e.item})},null,8,["v-node"])):A("",!0)]),default:i(o=>[e.item.children?(n(!0),M(Y,{key:0},j(e.item.children,d=>(n(),u(m,{key:d.prop,item:d,editable:e.editable},Q({_:2},[j(Object.keys(e.$slots),O=>({name:O,fn:i(N=>[U(e.$slots,O,q(Z(N)))])}))]),1032,["item","editable"]))),128)):o.$index>-1&&e.editable&&e.item.element?(n(),u(w,{key:1,prop:`${o.$index}.${e.item.prop}`,rules:s(S)(e.item)},{default:i(()=>[e.item.element==="cascader"?(n(),u(V,T({key:0,modelValue:o.row[e.item.prop],"onUpdate:modelValue":d=>o.row[e.item.prop]=d},e.item.attrs),null,16,["modelValue","onUpdate:modelValue"])):e.item.element==="checkbox"?(n(),u(_,T({key:1,modelValue:o.row[e.item.prop],"onUpdate:modelValue":d=>o.row[e.item.prop]=d},e.item.attrs),null,16,["modelValue","onUpdate:modelValue"])):e.item.element==="radio"?(n(),u(I,T({key:2,modelValue:o.row[e.item.prop],"onUpdate:modelValue":d=>o.row[e.item.prop]=d},e.item.attrs),null,16,["modelValue","onUpdate:modelValue"])):(n(),u(oe(`el-${e.item.element}`),T({key:3,modelValue:o.row[e.item.prop],"onUpdate:modelValue":d=>o.row[e.item.prop]=d},e.item.attrs),{default:i(()=>{var d,O,N;return[e.item.element==="select"?(n(!0),M(Y,{key:0},j(((d=e.item.attrs)==null?void 0:d.options)??[],g=>(n(),u(f,T({key:g.value},g),null,16))),128)):e.item.element==="checkbox-group"?(n(!0),M(Y,{key:1},j(((O=e.item.attrs)==null?void 0:O.options)??[],g=>(n(),u(_,T({key:g.value},g),null,16))),128)):e.item.element==="radio-group"?(n(!0),M(Y,{key:2},j(((N=e.item.attrs)==null?void 0:N.options)??[],g=>(n(),u(I,T({key:g.value},g),null,16))),128)):A("",!0)]}),_:2},1040,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["prop","rules"])):e.$slots[e.item.prop]?U(e.$slots,e.item.prop,T({key:2},o,{item:e.item})):e.item.component?(n(),M(Y,{key:3},[e.item.component==="operation"?(n(),u(Pe,T({key:0,slotProps:o,item:e.item},e.item.attrs,{onClickOperation:v[0]||(v[0]=(...d)=>l("click-operation",...d))}),null,16,["slotProps","item"])):(n(),u(oe(e.item.component),T({key:1,slotProps:o,item:e.item},e.item.attrs),null,16,["slotProps","item"]))],64)):e.item.formatter?(n(),u(s(G),{key:4,"v-node":e.item.formatter({...o,item:e.item})},null,8,["v-node"])):A("",!0)]),_:3},16)):A("",!0)}}}),mt=(t,h)=>{const p=k(),l=k([]),b=k(!1),S=k([]),R=D(()=>Array.isArray(t.toolbar)?t.toolbar.length>0:t.toolbar),e=D(()=>Array.isArray(t.toolbar)?t.toolbar.includes("refresh"):t.toolbar===!0),v=D(()=>Array.isArray(t.toolbar)?t.toolbar.includes("fullscreen"):t.toolbar===!0),m=D(()=>Array.isArray(t.toolbar)?t.toolbar.includes("setting"):t.toolbar===!0),V=()=>{h("refresh")},_=k(),{isFullscreen:I,toggleFullscreen:f}=Je(_),w=D(()=>{let a=0;const C=$=>{$.forEach(c=>{a++,te(c.children)||C(c.children)})};return C(l.value),a}),B=(a,C,$)=>(C.forEach(c=>{ue($)||(c.show=$);const{rendered:H=!0,show:J=!0}=c;typeof H=="function"?H(c)&&J&&a.push(c.prop):H&&J&&a.push(c.prop),c.children&&B(a,c.children,$)}),a),o=a=>{var $;const C=B([],l.value,a);($=p.value)==null||$.setCheckedKeys(C)},d=(a,C,$)=>{!te(a.children)&&$?a.show=!0:a.show=C;const c=p.value.getCheckedNodes().length||0;N.value=c<w.value&&c!==0,O.value=c===w.value},O=k(!0),N=k(!1),g=()=>{o(O.value)},L=(a,C,$)=>{if($==="inner")return!1;const c=a.parent,H=C.parent;return c===H},z=()=>{l.value=se(S.value)};return Be(()=>t.columns,a=>{te(a)||(S.value=se(a),b.value=!0),l.value=a},{immediate:!0}),{_columns:l,showToolbar:R,showRefresh:e,showFullscreen:v,showSetting:m,uTableRef:_,handleRefresh:V,isFullscreen:I,toggleFullscreen:f,treeRef:p,setCheckedKeys:o,checkedAll:O,checkedIndeterminate:N,handleChangeCheckedAll:g,handleResetColumns:z,handleCheckChange:d,allowDrop:L}},dt={class:"u-table-setting"},ct={class:"u-table-setting-header"},ce=ne({name:"UTable",__name:"table",props:{columns:{},editable:{type:Boolean,default:!1},showSelection:{type:Boolean,default:!1},selectionProps:{default:()=>({})},showIndex:{type:Boolean,default:!1},indexProps:{default:()=>({})},showExpand:{type:Boolean,default:!1},expandProps:{default:()=>({})},showTitleBar:{type:Boolean,default:!0},title:{},toolbar:{type:[Boolean,Array],default:!0},data:{},size:{},width:{},height:{},maxHeight:{},fit:{type:Boolean,default:!0},stripe:{type:Boolean,default:!1},border:{type:Boolean,default:!1},rowKey:{},context:{},showHeader:{type:Boolean,default:!0},showSummary:{type:Boolean,default:!1},sumText:{},summaryMethod:{},rowClassName:{},rowStyle:{},cellClassName:{},cellStyle:{},headerRowClassName:{},headerRowStyle:{},headerCellClassName:{},headerCellStyle:{},highlightCurrentRow:{type:Boolean,default:!1},currentRowKey:{},emptyText:{},expandRowKeys:{},defaultExpandAll:{type:Boolean,default:!1},defaultSort:{},tooltipEffect:{},tooltipOptions:{},spanMethod:{},selectOnIndeterminate:{type:Boolean,default:!0},indent:{},treeProps:{},lazy:{type:Boolean,default:!1},load:{},className:{},style:{},tableLayout:{},scrollbarAlwaysOn:{type:Boolean,default:!1},flexible:{type:Boolean,default:!1},showOverflowTooltip:{type:[Boolean,Object],default:!1},tooltipFormatter:{},appendFilterPanelTo:{},scrollbarTabindex:{}},emits:["click-operation","refresh"],setup(t,{expose:h,emit:p}){const l=t,b=p,S=Ae(),R=k(),e=k(),v=D(()=>x(l.indexProps,["formatter","renderHeader"])),m=D(()=>x(l.selectionProps,["formatter","renderHeader"])),V=Oe(),_=D(()=>{const r=Object.keys(l).filter(y=>ue(l[y]));return r.push("columns","editable"),x({...l,...V},r)}),I=(r,y,K)=>{b("click-operation",r,y,K)},{_columns:f,showToolbar:w,showRefresh:B,showFullscreen:o,showSetting:d,uTableRef:O,handleRefresh:N,isFullscreen:g,toggleFullscreen:L,treeRef:z,setCheckedKeys:a,checkedAll:C,checkedIndeterminate:$,handleChangeCheckedAll:c,handleResetColumns:H,handleCheckChange:J,allowDrop:pe}=mt(l,b);return h(new Proxy({},{get(r,y){var W;return y==="validate"?e.value.validate:y==="validateField"?e.value.validateField:y==="scrollToField"?e.value.scrollToField:y==="resetFields"?e.value.resetFields:y==="clearValidate"?e.value.clearValidate:(((W=S.refs)==null?void 0:W.tableRef)??{})[y]},has(r,y){return Reflect.has(R.value,y)||Reflect.has(e.value,y)}})),(r,y)=>{const K=F("el-button"),W=F("el-tooltip"),he=F("el-checkbox"),ye=F("el-tree"),be=F("el-popover"),ee=F("el-table-column"),ge=F("el-table"),ke=F("el-form");return n(),M("div",{class:ie(["u-table",{"is-fullscreen":s(g)}]),ref_key:"uTableRef",ref:O},[r.showTitleBar?(n(),u(Ve,{key:0,title:r.title,"show-icon":!1},{default:i(()=>[U(r.$slots,"title")]),toolbar:i(()=>[U(r.$slots,"toolbar"),s(w)?(n(),M(Y,{key:0},[s(B)?(n(),u(W,{key:0,content:"刷新",placement:"top",teleported:!1},{default:i(()=>[P(K,{circle:"",icon:s(Xe),onClick:s(N)},null,8,["icon","onClick"])]),_:1})):A("",!0),s(o)?(n(),u(W,{key:1,content:s(g)?"退出全屏":"全屏",placement:"top",teleported:!1},{default:i(()=>[P(K,{circle:"",icon:s(qe),onClick:y[0]||(y[0]=E=>s(L)())},null,8,["icon"])]),_:1},8,["content"])):A("",!0),s(d)?(n(),u(W,{key:2,content:"设置",placement:"top",teleported:!1},{default:i(()=>[P(K,{circle:""},{default:i(()=>[P(be,{placement:"bottom-end",trigger:"click",onBeforeEnter:y[2]||(y[2]=E=>s(a)()),"popper-class":"u-table-setting-popper",teleported:!1},{reference:i(()=>[P(K,{circle:"",icon:s(Ge)},null,8,["icon"])]),default:i(()=>[X("div",dt,[X("div",ct,[P(he,{modelValue:s(C),"onUpdate:modelValue":y[1]||(y[1]=E=>Ee(C)?C.value=E:null),onChange:s(c),indeterminate:s($)},{default:i(()=>[re("全选")]),_:1},8,["modelValue","onChange","indeterminate"]),P(K,{type:"primary",link:"",onClick:s(H)},{default:i(()=>[re("重置")]),_:1},8,["onClick"])]),P(ye,{ref_key:"treeRef",ref:z,data:s(f),"node-key":"prop","show-checkbox":"",draggable:"","allow-drop":s(pe),onCheckChange:s(J)},null,8,["data","allow-drop","onCheckChange"])])]),_:1})]),_:1})]),_:1})):A("",!0)],64)):A("",!0)]),_:3},8,["title"])):A("",!0),P(ke,{ref_key:"formRef",ref:e,model:r.data,"show-message":!1},{default:i(()=>[P(ge,T({ref_key:"tableRef",ref:R},_.value),Q({default:i(()=>[r.showExpand?(n(),u(ee,T({key:0,type:"expand"},r.expandProps),{default:i(E=>[U(r.$slots,"expand",q(Z(E)))]),_:3},16)):A("",!0),r.showIndex?(n(),u(ee,T({key:1,type:"index"},v.value),Q({_:2},[r.indexProps.renderHeader?{name:"header",fn:i(E=>[P(s(G),{"v-node":r.indexProps.renderHeader(E)},null,8,["v-node"])]),key:"0"}:void 0,r.indexProps.formatter?{name:"default",fn:i(E=>[P(s(G),{"v-node":r.indexProps.formatter(E)},null,8,["v-node"])]),key:"1"}:void 0]),1040)):A("",!0),r.showSelection?(n(),u(ee,T({key:2,type:"selection"},m.value),null,16)):A("",!0),(n(!0),M(Y,null,j(s(f),E=>(n(),u(ut,{key:E.prop,item:E,editable:r.editable,onClickOperation:I},Q({_:2},[j(Object.keys(r.$slots),ae=>({name:ae,fn:i(ve=>[U(r.$slots,ae,q(Z(ve)))])}))]),1032,["item","editable"]))),128))]),_:2},[r.$slots.empty?{name:"empty",fn:i(()=>[U(r.$slots,"empty")]),key:"0"}:void 0,r.$slots.append?{name:"append",fn:i(E=>[U(r.$slots,"append",q(Z(E)))]),key:"1"}:void 0]),1040)]),_:3},8,["model"])],2)}}}),fe=ce;fe.install=t=>{t.component("UTable",ce)};const ft=(t,h=!0)=>{const p=k(!1),l=k(),b=k({}),S=k([]),R=(m,V,_)=>{const I=S.value.find(f=>f.prop===m);I&&lt(I,V,_)},e=m=>{S.value=m},v=async()=>{if(t){p.value=!0;try{const m=await t();b.value=m}catch(m){console.error(m)}finally{p.value=!1}}};return le(()=>{h&&v()}),{loading:p,formRef:l,formData:b,formOptions:S,setFormOptions:e,updateFormItemOption:R,getFormData:v}},$t=(t,h={})=>{const{auto:p=!0,isShallow:l=!0,defaultFormData:b={},defaultPageSize:S=10}=h,R=k(!1),e=k({pageNum:1,pageSize:S,total:0}),{formRef:v,formData:m,formOptions:V,setFormOptions:_,updateFormItemOption:I,getFormData:f}=ft(()=>b,!1);f();const{tableRef:w,tableData:B,tableColumns:o,tableOperations:d,multipleSelection:O,handleSelectionChange:N,toggleTableColumnRendered:g,setTableColumns:L,setTableOperations:z}=Qe(()=>[],{auto:!1,isShallow:l}),a=async()=>{R.value=!0;const c={...m.value,pageNum:e.value.pageNum,pageSize:e.value.pageSize},H=await t(c);B.value=H.rows,e.value.total=H.total},C=async c=>{e.value.pageNum=1,m.value={...m.value,...c},await a()},$=async c=>{e.value.pageNum=1,m.value={...b,...c},await a()};return le(()=>{p&&a()}),{loading:R,formRef:v,formData:m,formOptions:V,setFormOptions:_,updateFormItemOption:I,tableRef:w,tableData:B,tableColumns:o,tableOperations:d,multipleSelection:O,handleSelectionChange:N,toggleTableColumnRendered:g,setTableColumns:L,setTableOperations:z,pagerParams:e,fetchData:a,query:C,reset:$}},pt=[Ie,fe,de,Ue],ht=t=>{pt.forEach(h=>{t.component(h.name,h)})},Ft={install:ht};export{de as UContextMenu,Ie as UForm,Ue as UOperation,fe as UTable,Ft as default,ht as install,ft as useForm,Je as useFullscreen,$t as usePage,Qe as useTable};
